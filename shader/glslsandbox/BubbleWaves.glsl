{"code": "#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform float time;\nuniform vec2 mouse;\nuniform vec2 resolution;\n\nfloat scene(in vec3 p)\t\n{\n\tfloat r = 0.05; \n\tfloat ox = float(int(p.x*10.0+10.0*r)); \n\tfloat oy = float(int(p.y*10.0+10.0*r)); \n\t\n\tp.x = mod(p.x+r, 2.0*r) - r; \n\tp.y = mod(p.y+r, 2.0*r) - r; \n\tp.z += sin(ox*ox*0.01+oy*oy*0.00+time)*0.3+cos(oy*ox*0.01+ox*oy*0.00+time)*0.3; \n\treturn length(p) - r; \n}\nvec3 get_normal(in vec3 p)\n{\n\tvec3 eps = vec3(0.001, 0, 0); \n\tfloat nx = scene(p + eps.xyy) - scene(p - eps.xyy); \n\tfloat ny = scene(p + eps.yxy) - scene(p - eps.yxy); \n\tfloat nz = scene(p + eps.yyx) - scene(p - eps.yyx); \n\treturn normalize(vec3(nx,ny,nz)); \n}\n\nfloat rm2(in vec3 ro, in vec3 rd)\n{\n\tvec3 pos = ro; \n\tfloat dist = 1.0; \n\tfloat d; \n\tfor (int i = 0; i < 5; i++) {\n\t\td = scene(pos); \n\t\tpos += rd*d;\n\t\tdist -= d; \n\t}\n\treturn dist; \n}\n\n\nvec3 rotatex(in vec3 p, float ang)\n{\n\treturn vec3(p.x,p.y*cos(ang)-p.z*sin(ang),p.y*sin(ang)+p.z*cos(ang)); \n}\nvoid main( void ) {\n\n\tvec2 p = 2.0*( gl_FragCoord.xy / resolution.xy )-1.0;\n\tp.x *= resolution.x/resolution.y; \n\n\tvec3 color = vec3(0.1); \n\t\n\tvec3 ro = vec3(0,0,1.0);\n\tvec3 rd = normalize(vec3(p.x,p.y,-2.0)); \n\trd = rotatex(rd, 1.2); \n\tvec3 pos = ro; \n\tfloat dist = 0.0; \n\tfloat d; \n\tfor (int i = 0; i < 64; i++) {\n\t\td = scene(pos)*0.5; \n\t\tpos += rd*d;\n\t\tdist += d; \n\t}\n\tif (dist < 10.0 && abs(d) < 0.1) {\n\t\tvec3 l = normalize(vec3(1,1,1)); \n\t\tvec3 n = get_normal(pos); \n\t\tvec3 r = reflect(rd, n); \n\t\tfloat fres = clamp(dot(n, -rd),0.0, 1.0);  \n\t\tfloat diff = clamp(dot(n, l), 0.0, 1.0); \n\t\tfloat spec = pow(clamp(dot(r, l), 0.0, 1.0), 40.0);  \n\t\tfloat shade = rm2(pos+0.05*n, n); \n\t\tcolor = mix(vec3(1,1,1)*0.8, vec3(1,1,1)*0.0, fres); \n\t\tcolor += 0.1*vec3(1,1,1)*diff*pos.y; \n\t\tcolor += vec3(1,1,1)*spec; \n\t\tcolor += 0.1*shade; \n\t\tcolor /= dist; \n\t}\n\t\n\t\n\tgl_FragColor = vec4(color, 1.0); \n}", "user": "25ff45d", "parent": "/e#45041.0", "id": "45221.0"}