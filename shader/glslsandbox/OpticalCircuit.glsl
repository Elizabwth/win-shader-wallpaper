{"code": "// Optical Circuit by 0x4015 http://www.pouet.net/prod.php?which=65125\n// glslsandboxified by @301z\n\nprecision mediump float;\n\n#define scene 4\n\n#if scene==0\n\t#define shader 0\n\t#define timeOffset 0.122667\n#elif scene==1\n\t#define shader 1\n\t#define timeOffset 115.984024\n#elif scene==2\n\t#define shader 2\n\t#define timeOffset 229.984039\n#elif scene==3\n\t#define shader 5\n\t#define timeOffset 627.984131\n#elif scene==4\n\t#define shader 3\n\t#define timeOffset 350.986725\n#elif scene==5\n\t#define shader 4\n\t#define timeOffset 23.984083\n#else\n\t#define shader 0\n\t#define timeOffset 31.983999\n#endif\n#if shader==0\n\t#define zz(a) (a==1||a==7||a==11||a==31||a==45)\n#elif shader==1\n\t#define zz(a) (a==2||a==7||a==11||a==31)\n#elif shader==2\n\t#define zz(a) (a==4||a==7||a==12||a==31||a==45)\n#elif shader==3\n\t#define zz(a) (a==8||a==11||a==12||a==31||a==45)\n#elif shader==4\n\t#define zz(a) (a==16||a==31)\n#else\n\t#define zz(a) (a==32||a==45)\n#endif\n#define z(a) (zz(a)?1:0)\n\nuniform float time;\nuniform vec2 resolution;\n\nfloat A, D, E;\nvec3 B, C;\n\nvec3 F(vec3 a, float b) {\n\tfloat c = sin(b), d = cos(b);\n\treturn mat3(d, -c, 0, c, d, 0, 0, 0, 1) * a;\n}\n\nvec3 G(vec3 a, float b) {\n\ta = fract(a * .2) * 2.0 - 1.0;\n\ta.z = b;\n\tfloat c = 50.0;\n\tfor (int i = 0; i < 6 + z(16) + z(32) * 3; ++i) {\n\t\tfloat d = clamp(dot(a, a), .05, .65);\n\t\tc *= d;\n\t\ta = abs(a) / d - 1.31;\n\t\ta.xy = a.xy * mat2(1, 1, -1, 1) * .70710678118;\n\t}\n\treturn a * c;\n}\n\nvec3 H(vec3 a) {\n\tfloat b = float(3 + z(4) * 4);\n\ta = F(a, (floor(atan(a.y, a.x) * b * .5 / 3.1415926546) * 2.0 + 1.0) * 3.1415926546 / b);\n\ta.y = abs(a.y);\n\treturn a;\n}\n\nvec3 I(vec3 a) {\n\ta.z -= A * 1.5;\n\tfloat b = A * .5 + floor(a.z);\n\treturn F(vec3(a.x, a.y + sin(b), fract(a.z) - .5), 3.1415926546 - cos(b));\n}\n\nvec3 Z(float t) {\n\treturn vec3(0, -sin(t * .6), t * 1.6 + .5) + sin(t * .01 * vec3(11, 23, 19)) * vec3(.135, .25, .25);\n}\n\nfloat J(vec3 a) {\n\tvec3 b = abs(fract(a * 5.0) - .5) * .2;\n\treturn max(max(b.x, b.y), b.z) - .078;\n}\n\nfloat K(vec3 a) {\n\tvec3 b = abs(fract(a * 2.0) - .5) * .5;\n\treturn max(max(b.x, b.y), b.z);\n}\n\nfloat L(vec3 a) {\n\tvec3 b = abs(fract(a + vec3(0, .5, 0)) - .5), c = abs(fract(a + .5) - .5);\n\treturn .033 - min(max(b.x - .46, b.y), .08 - max(c.x, c.y));\n}\n\nfloat M(vec3 a) {\n\tvec3 b = abs(fract(a * 4.0 + .5) - .5) * .25;\n\treturn max(max(max(b.x, b.y), b.z) - .08, max(L(a) - .01, .012 - length(fract(a * 25.0) - .5) * .04));\n}\n\nfloat N(vec3 a) {\n\treturn min(min(min(M(a), M(a.zyx)), M(a.zxy)), min(min(L(a), L(a.zyx)), L(a.zxy)));\n}\n\nfloat O(vec3 a) {\n\tvec4 b = vec4((fract(a * .2 + .5) - .5) * 4.0, 1.0);\n\tfor (int i = 0; i < 4; ++i) {\n\t\tb.xyz = clamp(b.xyz, -1.0, 1.0) * 2.0 - b.xyz;\n\t\tb *= clamp(max(.21 / dot(b.xyz, b.xyz), .21), 0.0, 1.0) * -15.7;\n\t}\n\ta = b.xyz / b.w * 5.0;\n\treturn max(length(a) - 1.0, N(a)) * .25;\n}\n\nfloat P(vec3 a) {\n\tvec3 b = abs(a);\n\treturn max(max(max(b.x, b.y), b.z), max(max(length(b.xy), length(b.yz)), length(b.zx)) - .2) - 1.0;\n}\n\nfloat Q(vec3 a) {\n\treturn max(abs(length(a * vec3(1, 1, .3)) - .325) - .025, -a.z);\n}\n\nfloat R(vec3 a) {\n\tvec3 b = abs(a);\n\treturn max(b.y, dot(vec3(.87, .5, 0), b)) - 1.0;\n}\n\nfloat S(vec3 a) {\n\treturn max(max(abs(length(a - vec3(0.0, 0.0, 5.0)) - 5.0) - .05, R(a)), a.z - 2.0);\n}\n\nfloat T(vec3 a) {\n#if zz(1)\n\treturn max(K(a) - .201, O(a))\n#elif zz(2)\n\tvec3 b = a * 20.0;\n\tb.y += A * 5.0 * (fract(dot(floor(b), vec3(1, 0, 1)) * 3.1415926546) - .5);\n\tvec3\n\t\tc = F((fract(b.zxy) - .5) *.05, A * 8.0 * (fract(dot(floor(b), vec3(3.1415926546))) - .5)),\n\t\te = abs(fract(a + vec3(.5, .5, 0)) - .5);\n\ta = F(a, A * .025 * (fract((a.z * 2.0 - fract(a.z * 2.0)) * .437) - .5));\n\tfloat d = K(a);\n\treturn\n\t\tmin(\n\t\t\tmax(min(max(d - .201, O(a)), .299 - d), length(a) - 20.0),\n\t\t\tmax(max(e.x, e.z) - .05, min(max(length(c) - .006, L(c * 10.0) * .1 - .0002), .04)))\n#elif zz(4)\n\tfloat b = a.z * 2.0 - fract(a.z * 2.0);\n\ta = H(F(a, A * .8 * (fract(b * .347) - .5)));\n\tfloat d = abs(fract(a.z * 2.0) - .5) * .5;\n\treturn\n\t\tmin(\n\t\t\tmax(\n\t\t\t\tmin(\n\t\t\t\t\tN(a + mix(vec3(.7, .875, .5), vec3(.9, .925, .3), fract(vec3(.37, .53, 1) * b))),\n\t\t\t\t\tN(a / 1.3 + mix(vec3(.7, .7, .5), vec3(.9, .925, .3), fract(vec3(.71, .87, 1) * b))) * 1.3),\n\t\t\t\td-.225),\n\t\t\t.275 - d)\n#elif zz(8)\n\ta = H(a);\n\tfloat d = length(a);\n\treturn max(max(J(a * .2) * 5.0 - .03, .015 - N((fract(a * 4.0 + .2) - .5) * .25)), max(min(d - 4.0, 5.9 - d), 1.5 - d))\n#elif zz(16)\n\tvec3 b = I(a) * 20.0, c = H(b * 2.0 + vec3(0, 0, 2)) - vec3(1.4, 0, 0), d = b;\n\td.y = abs(d.y);\n\treturn\n\t\tmin(\n\t\t\tmin(\n\t\t\t\tmin(\n\t\t\t\t\tmin(max(R(d * 4.0 - vec3(2, 5, 0)) * .25, abs(d.z) - 1.0), S(d.yzx * vec3(1, .5, .5) * 1.5 + vec3(.3, 0, 0)) / 1.5),\n\t\t\t\t\tmax(min(.1 - abs(d.x), -d.z), S(vec3(0, 0, 1) - d.xzy * vec3(1, .5, .5)))),\n\t\t\t\tmin(\n\t\t\t\t\tmin(max(P(c), -P(c * 1.2 + vec3(0, 0, 1.5)) / 1.2), Q(c + vec3(0, 0, 1.5))),\n\t\t\t\t\tQ(vec3(abs(c.xy), c.z) - vec3(.5, .5, -1.5))) * .5) * .05,\n\t\t\t.15 - abs(a.x))\n#else\n\tvec3 b = (a - vec3(.1, .21, sin(A * .025) * 3.0)) * 5.0;\n\tb.y += (fract(floor(b.z) * 3.1415926546) - .5) * 3.1415926546;\n\tvec3 c = floor(b) + .5;\n\tvec4 d = vec4(normalize(sin(c * vec3(1, 2, 3))) * sin(A * .5), cos(A * .5));\n\tfloat e = d.x, f = d.y, g = d.z, h = d.w;\n\tb = abs(\n\t\t\tmat3(\n\t\t\t\t.5 - f * f - g * g, e * f - h * g, e * g + h * f,\n\t\t\t\te * f + h * g, .5 - e * e - g * g, f * g - h * e,\n\t\t\t\te * g - h * f, f * g + h * e, .5 - e * e - f * f) * 2.0 * (b - c));\n\tb.xy += fract(c.zz * c.yz * vec2(.11, .31)) * .095;\n\treturn min(max(max(b.x, b.y), b.z) - .1, .3) * .2\n#endif\n\t;\n}\n\nfloat U(vec3 a) {\n#if zz(7)\n\treturn abs(fract(a.z + float(z(4)) * .5) - .5)\n#elif zz(8)\n\ta = H(a);\n\tfloat d = length(a);\n\treturn abs(max(min(d - 4.0, 5.95 - d), J(a * .4) * 2.5 - .08 + d * .018))\n#elif zz(16)\n\treturn .15 - abs(a.x);\n#else\n\treturn abs(max(.02 - L(a), O(a)))\n#endif\n\t;\n}\n\nvec3 V(float a, vec3 b, float c) {\n\ta *= c;\n\treturn 1.0 / ((1.0 + 2.0 * b / a + b * b / (a * a)) * c + .0001);\n}\n\nvec3 W(vec3 a, float b, float c, float d) {\n\tvec3 e =\n\t\t(V(.01, abs(a), d) * 2.0 + V(.05, vec3(length(a.yz), length(a.zx), length(a.xy)), d) * 5.0) *\n\t\t\t(sin(A * vec3(2.1, 1.3, 1.7) + b * 10.0) + 1.0);\n\treturn(e * 7.0 + e. yzx * 1.5 + e.zxy * 1.5) * max(1.0 - c * 200.0 / d, 0.0) / d * float(100 - z(2) * 30 - z(32) * 80 - z(16) * 88);\n}\n\nfloat X(vec3 a, float t, float b) {\n\tfloat c = fract(t + b), e = t - c;\n\tvec3\n\t\tf = Z(e) * vec3(0, 1, 1) + sin(vec3(0, 23, 37) * e),\n\t\tg = normalize(sin(vec3(0, 17, 23) * e)) * 8.0,\n\t\th = f + g + vec3(sin(e * 53.0) * .15, 0, 0),\n\t\tj = f - g + vec3(sin(e * 73.0) * .15, 0, 0),\n\t\tk = mix(h, j, c - .15),\n\t\tl = mix(h, j, c + .15);\n\tt = dot(a - k, l - k) / dot(l - k, l - k);\n\treturn length((t < 0.0 ? k : t > 1.0 ? l : k + t * (l - k)) - a);\n}\n\nvec4 Y(vec3 a, float b, float t) {\n\tvec3\n\t\tc = I(a) * 20.0,\n\t\td = vec3(length(c + vec3(-.35, .57, 2)), length(c + vec3(-.35, -.57, 2)), length(c + vec3(.7, 0, 2))),\n\t\te = V(.2, d, b),\n\t\tf = vec3(X(a, t, 0.0), X(a, t, .3), X(a, t, .6)), g = V(.001, f, b);\n\t\treturn vec4(\n\t\t\t(e.x + e.y + e.z) * vec3(30, 75, 150) * (E + 1.0) + (g.x + g.y + g.z) * vec3(1.0, .1, .2) * 5000.0,\n\t\t\tmin(min(min(d.y, d.z), d.x) * .05, min(min(f.y, f.z), f.x)));\n}\n\nvoid main() {\n\t{\n\t\tA = time + timeOffset;\n\t\tvec2 glVertex = gl_FragCoord.xy / resolution.xy * 2.0 - 1.0;\n\n\t\tvec3\n\t\t\ta = float(z(2)) * normalize(sin(A * .001 * vec3(21, 11, 17))) * 20.1 + float(z(16)) * Z(A) + float(z(45)) *\n\t\t\t\t\t(vec3(0, 0, sin(A * .025)) * float(5 + z(4) * 15 + z(8) * 7) + sin(A * .001 * vec3(21, 11, 17)) * (.01 + float(z(11)) * .04)),\n\t\t\tb = normalize(\n\t\t\t\t\tfloat(z(2)) * (sin(A * .001 * vec3(26, 106, 62)) - a * .05) +\n\t\t\t\t\tfloat(z(16)) * (vec3(0, -sin((A + sin(A * .2) * 4.0) * .5 + A * .1), (A + sin(A * .2) * 4.0) * 1.6 + .5) - a) +\n\t\t\t\t\tfloat(z(45)) * (sin(A * .002 * vec3(13, 53, 31)) * 50.0 + vec3(0, 0, sin(A * .05) * 5.0) - a)),\n\t\t\tc = normalize(cross(b, sin(A * .001 * vec3(31, 17, 29))));\n\t\tfloat d = A * float(1 + z(16) * 4);\n\t\tfor (int i = 0; i < 20; ++i) {\n\t\t\tfloat t = A - float(i) * .1;\n\t\t\tvec4 y = Y(Z(t), 25.0, t);\n\t\t\td += float(z(16)) * sin((y.w + t) * 5.0) * y.x * .05 * exp(float(i) * -.25);\n\t\t}\n\t\tvec3\n\t\t\te = normalize(vec3(sin(vec2(.53, .47) * d) * 4.0 + sin(vec2(.91, 1.1) * d) * 2.0 + sin(vec2(2.3, 1.7) * d), 200)),\n\t\t\tf = normalize(cross(e, vec3(sin(d), 50, 0)));\n\t\tB = a;\n\t\tC = mat3(c, cross(c, b), b) * (f * glVertex.x * 1.78 + cross(f, e) * glVertex.y + e * 1.4);\n\n\t\tD = fract(sin((C.x + C.y + C.z) * 99.317 * 3.1415926546) * 85.081 * 3.1415926546);\n\t\tE = fract(sin(A * 99.317 * 3.1415926546) * 85.081 * 3.1415926546);\n\t}\n\n\tvec3 a = normalize(C), c = vec3(1), e = B, f = a, g = e, b = g * 0.0, s = vec3(1, -1, -1) * .0005;\n\tvec4 l = vec4(B, 1), k = l * 0.0, j = k, h = j;\n\tint m = 1;\n\tfloat t = 0.0, o = 1.0, p = 1.0, q = D * .01 + .99, n;\n\tfor (int i = 0; i < 64 + z(1) * 16 + z(16) * 32 - z(32) * 32; ++i) {\n\t\tg = e + f * t;\n\t\tfloat d = T(g);\n\t\tif (d < (t * 5.0 + 1.0) * .0001) {\n\t\t\tvec3 u = normalize(T(g + s) * s + T(g + s.yyx) * s.yyx + T(g + s.yxy) * s.yxy + T(g + s.xxx) * s.xxx);\n\t\t\tfloat r = pow(abs(1.0 - abs(dot(u, f))), 5.0) * .9 + .1;\n\t\t\to += t * p;\n\t\t\tp = p * 5.0 / r;\n\t\t\te = g + u * .0001;\n\t\t\tf = reflect(f, u);\n\t\t\tt = 0.0;\n\t\t\tfloat v = dot(u, u);\n\t\t\tif (v < .9 || 1.1 < v || v != v)\n\t\t\t\tu = vec3(0);\n\t\t\tif (m < 4) {\n\t\t\t\th = j;\n\t\t\t\tj = k;\n\t\t\t\tk = l;\n\t\t\t\tl = vec4(g, max(floor(o), 1.0) + clamp(r, .001, .999));\n\t\t\t\t++m;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tt = min(t + d * q, 100.0);\n\t}\n\tif (m < 4) {\n\t\th = j;\n\t\tj = k;\n\t\tk = l;\n\t\tl = vec4(g, o + t * p);\n\t\t++m;\n\t}\n\t{\n\t\tint a = m;\n\t\tfor (int i = 0; i < 4; ++i)\n\t\t\tif (a < 4) {\n\t\t\t\th = j;\n\t\t\t\tj = k;\n\t\t\t\tk = l;\n\t\t\t\t++a;\n\t\t\t}\n\t}\n\te = h.xyz;\n\tf = normalize(j.xyz - h.xyz);\n\tn = length(j.xyz - h.xyz);\n\tt = 0.0;\n\tq = D * .1 + .8 + float(z(11)) * .1;\n\to = 1.0;\n\tp = 0.0;\n\tfor (int i = 0; i < 64 + z(1) * 16 + z(16) * 32 - z(32) * 32; ++i) {\n\t\tif (t > n) {\n\t\t\tif (m < 3)\n\t\t\t\tbreak;\n\t\t\th = j;\n\t\t\tj = k;\n\t\t\tk = l;\n\t\t\t--m;\n\t\t\te = h.xyz;\n\t\t\tf = normalize(j.xyz - h.xyz);\n\t\t\tn = length(j.xyz - h.xyz);\n\t\t\tt = 0.0;\n\t\t\tif (n < .0001)\n\t\t\t\tbreak;\n\t\t\tfloat r = fract(h.w);\n\t\t\to = h.w - r;\n\t\t\tp = (floor(j.w) - o) / n;\n\t\t\tc *= mix(vec3(.17, .15, .12), vec3(1), r);\n\t\t}\n\t\tg = e + f * t;\n\t#if zz(16)\n\t\tvec4 y = Y(g, o + p * t, A);\n\t#endif\n\t\tfloat u = U(g);\n\t#if zz(16)\n\t\tu = min(u, y.w);\n\t#endif\n\t\tg -=\n\t#if zz(7)\n\t\t\tvec3(0,0, vec2(sign(fract(g.z) - .5))) // vec3(0,0, sign(fract(g.z) - .5))\n\t#else\n\t\t\tnormalize(U(g + s) * s + U(g + s.yyx) * s.yyx + U(g + s.yxy) * s.yxy + U(g + s.xxx) * s.xxx)\n\t#endif\n\t\t\t* u;\n\t\tfloat v = sin(A * .05 + g.z) * .5, w = u * q + float(z(32)) * .0005 + float(z(31)) * .001;\n\t\tvec3 x = G(\n\t#if zz(12)\n\t\t\tH(g)\n\t#else\n\t\t\tg\n\t#endif\n\t\t\t, v);\n\t\tb += (W(x, v, u, o + p * t) + W(x, v, u, o + p * t + 50.0 + float(z(8) * 50))\n\t#if zz(16)\n\t\t\t+ y.xyz\n\t#endif\n\t\t\t) * c * w;\n\t\tc *= pow(.7, w);\n\t\tt += w;\n\t}\n\tgl_FragColor = vec4(pow(b, vec3(.45)) - float(z(1)) * max(A * .2 - 8.0, 0.0), 1.0);\n}\n", "user": "f9b0f37", "parent": null, "id": "23480.0"}