{"code": "#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform float time;\nuniform vec2 mouse;\nuniform vec2 resolution;\n\n#define pi 3.1415926535897932384626433832795\n#define flyCount 30.\n\n\nfloat testFuncFloor(float v){\n\n    const float amplitude=1.;\n    const float t=pi*2.;\n    float k=4.*amplitude/t;\n    float r=mod( v  ,t);\n    float d=floor(v /(.5* t) );\n    \n\treturn mix(k* r-amplitude ,  amplitude*3.-k* r ,mod(d,2.)  );\n}\n\nfloat getRad(vec2 q){\n   return atan(q.y,q.x); \n}\n\nvec2 noise(vec2 tc){\n    //return (2.*texture2D(iChannel0, tc).xy-1.).xy;\n    return vec2(fract(sin(tc.x) ),fract(sin(tc.y) ) );\n}\n\nfloat firefly(vec2 p,float size){\n    \n\t//return smoothstep(0.,size,dot(p,p)*200. );\n\treturn smoothstep(0.,size,length(p) );\n\n}\n\nconst float pow=1.;\nconst float flySpeed=0.1;\n\n\nvoid main( void ) {\n\n    float pow=1.;\n    const float duration=1.;\n    float t=duration*(1.+sin(3.* time ) );\n\tvec2 p= gl_FragCoord.xy / resolution.xy;\n   \n\tfloat ratio= resolution.y/resolution.x;\n    \n     vec2 uv=p;\n    uv.y*=ratio;\n    \n    \n    vec2 flowerP=vec2(.618,0.518);\n    vec2 q=p-flowerP-vec2( pow*.008*cos(3.*time) ,pow*.008*sin(3.*time) ) ;\n    vec2 rootP=p-+flowerP-vec2( pow*.02*cos(3.*time)*p.y ,-0.48+pow*.008*sin(3.*time) );\n   \n\tq.y*=ratio;\n\t\n    //sky\n    vec3 col=mix( vec3(0.1,0.6,0.5), vec3(0.2,0.1,0.2), sqrt(p.y)*.6 );\n    \n\n   \t//draw stem \n    float width=0.01;\n    float h=.5;\n    float w=.0005;\n    col=mix(vec3(.5,.7,.4),col, 1.- (1.- smoothstep(h,h+width, abs(rootP.y ) )  ) * (1.- smoothstep(w,w+width, abs(rootP.x-0.1*sin(4.*rootP.y+pi*.35) ) )  ) );\n   \t\n    //draw flower \n    vec3 flowerCol=mix(vec3(.7,.7,.2),vec3(.7,.9,.7), smoothstep( .0,1.,length(q)*10. ) ) ;\n\n    const float edge=.02;\n    float r= .1+0.05*( testFuncFloor( getRad( q ) *7.  + 2.*q.x*(t-duration)  )  );\n\n\tcol=mix(flowerCol,col, smoothstep(r,r+edge,  length( q )  ) );\n    \n\t//draw buds\n    float r1=0.;\n    r1=.04;\n    vec3 budCol=mix (vec3(.3,.4,0.),vec3(.9,.8,0.), length(q)*10. );\n\tcol=mix(budCol,col, smoothstep(r1,r1+0.01,  length( q )  ) );\n    \n    //draw firefly\n\t//vec3 flyCol=mix (vec3(.1,.4,0.1),vec3(.1,1.,1.), length(q)*10. );\n\t\n    for (float i=0.;i<flyCount;i++){\n\t\t\n        float seed=i/flyCount;\n\tfloat seed2=fract(i/flyCount*5.);\n        float t1=1.*(1.+sin(noise(vec2(seed) ).x* time ) );\n\t   \tvec2 fireflyP=uv- \n\t\t    vec2(noise(vec2(seed2) ).x+noise(vec2(seed2) ).x*t1*flySpeed,\n\t\t\t noise(vec2(seed) ).y+noise(vec2(seed) ).y*t1*flySpeed);\n\t    \n\t\tfloat fly= firefly( fireflyP,.002+.008*seed );\n  \t\tvec3 flyCol=mix(vec3(0.1,0.9,0.1)*t1,vec3(0.), fly );\n   \t\tcol+=flyCol;\n    }\n\t\n    gl_FragColor=vec4(col,0.);\n\t/*\n\tvec2 position = ( gl_FragCoord.xy / resolution.xy ) + mouse / 4.0;\n\n\tfloat color = 0.0;\n\tcolor += sin( position.x * cos( time / 15.0 ) * 80.0 ) + cos( position.y * cos( time / 15.0 ) * 10.0 );\n\tcolor += sin( position.y * sin( time / 10.0 ) * 40.0 ) + cos( position.x * sin( time / 25.0 ) * 40.0 );\n\tcolor += sin( position.x * sin( time / 5.0 ) * 10.0 ) + sin( position.y * sin( time / 35.0 ) * 80.0 );\n\tcolor *= sin( time / 10.0 ) * 0.5;\n\n\tgl_FragColor = vec4( vec3( color, color * 0.5, sin( color + time / 3.0 ) * 0.75 ), 1.0 );\n\t*/\n}", "user": "e12b89c", "parent": null, "id": "28511.1"}