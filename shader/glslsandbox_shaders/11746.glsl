{"code": "#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform float time;\nuniform vec2 mouse;\nuniform vec2 resolution;\n#define pi 3.141592653589793238462643383279\n#define pi_inv 0.318309886183790671537767526745\n#define pi2_inv 0.159154943091895335768883763372\n\nvec2 complex_mul(vec2 factorA, vec2 factorB){\n  return vec2( factorA.x+factorB.x + factorA.y*factorB.y, factorA.x*factorB.y + factorA.y*factorB.x);\n}\n\nvec2 complex_div(vec2 numerator, vec2 denominator){\n   return vec2( numerator.x*denominator.x + numerator.y*denominator.y,\n                numerator.y*denominator.x - numerator.x*denominator.y)/\n          vec2(denominator.x*denominator.x + denominator.y*denominator.y);\n}\n\nvec2 wrap_flip(vec2 uv){\n\treturn uv;\n}\n \nfloat border(vec2 domain, float thickness){\n   vec2 uv = fract(domain-vec2(0.5));\n   uv = min(uv,1.-uv)*2.;\n   return clamp(max(uv.x,uv.y)-1.+thickness,0.,1.)/(thickness);\n}\n\nfloat circle(vec2 uv, vec2 aspect, float scale){\n\treturn clamp( 1. - length((uv-0.5)*aspect*scale), 0., 1.);\n}\n\nfloat sigmoid(float x) {\n\treturn 2./(1. + exp2(-x)) - 1.;\n}\n\nfloat smoothcircle(vec2 uv, vec2 center, vec2 aspect, float radius, float sharpness){\n\treturn 0.5 - sigmoid( ( length( (uv - center) * aspect) - radius) * sharpness) * 0.5;\n}\n\nfloat lum(vec3 color){\n\treturn dot(vec3(0.30, 0.59, 0.11), color);\n}\n\nvec2 spiralzoom(vec2 domain, vec2 center, float n, float spiral_factor, float zoom_factor, vec2 pos){\n\tvec2 uv = domain - center;\n\tfloat angle = atan(uv.y, uv.x);\n\tfloat d = length(uv);\n\treturn vec2( angle*n*pi2_inv + log(d)*spiral_factor, -log(d)*zoom_factor) + pos;\n}\n\nvec2 mobius(vec2 domain, vec2 zero_pos, vec2 asymptote_pos){\n\treturn complex_div( domain - zero_pos, domain - asymptote_pos);\n}\n\nfloat gear(vec2 domain, float phase, vec2 pos){\n\tfloat angle = atan(domain.y - pos.y, domain.x - pos.x);\n\tfloat d = 0.2 + sin((angle + phase) * 10.)*0.1;\n\treturn smoothcircle(domain, pos, vec2(1), d, 128.);\n}\n\nfloat geartile(vec2 domain, float phase){\n\tdomain = fract(domain);\n\treturn \n\t\tgear(domain, -phase, vec2(-0.25,0.25)) + \n\t\tgear(domain, phase, vec2(-0.25,0.75)) + \n\t\tgear(domain, phase, vec2(1.25,0.25)) + \n\t\tgear(domain,- phase, vec2(1.25,0.75)) + \n\t\tgear(domain, -phase, vec2(0.25,-0.25)) + \n\t\tgear(domain, phase, vec2(0.75,-0.25)) + \n\t\tgear(domain, phase, vec2(0.25,1.25)) + \n\t\tgear(domain, -phase, vec2(0.75,1.25)) + \n\t\tgear(domain, phase, vec2(0.25,0.25)) + \n\t\tgear(domain, -phase, vec2(0.25,0.75)) + \n\t\tgear(domain, -phase, vec2(0.75,0.25)) + \n\t\tgear(domain, phase, vec2(0.75,0.75));\t\t\n}\nvoid main(void)\n{\n\t// domain map\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\t\n\t// aspect-ratio correction\n\tvec2 aspect = vec2(1.,resolution.y/resolution.x);\n\tvec2 uv_correct = 0.5 + (uv -0.5)/ aspect.yx;\n\tvec2 mouse_correct = 0.5 + ( mouse.xy / resolution.xy - 0.5) / aspect.yx;\n\t\t\n\tfloat phase = (time+1000.)*0.5;\n\tfloat dist = 1.;\n\tvec2 uv_bipolar = mobius(uv_correct, vec2(0.5 - dist*0.5, 0.5), vec2(0.5 + dist*0.5, 0.5));\n\tuv_bipolar = spiralzoom(uv_bipolar, vec2(0.), 5., -0.125*pi, 0.8, vec2(-0.125,0.125)*phase*5.);\n\tuv_bipolar = vec2(-uv_bipolar.y,uv_bipolar.x); // 90\u00b0 rotation \n\t\n\tvec2 uv_spiral = spiralzoom(uv_correct, vec2(0.5), 5., -0.125*pi, 0.8, vec2(-0.,0.25)*phase);\n\n\tvec2 uv_tilt = uv_spiral;\n//\tuv_tilt.y = fract(uv_tilt).y;\n\tfloat z = 1./(1.-uv_tilt.y)/(uv_tilt.y);\n\tfloat logz = log(z);\n\tuv_tilt = 0.5 + (uv_tilt - 0.5) * logz;\n\t\n\tfloat circle = geartile(uv_bipolar, -phase);\n\tfloat circle_outline = circle*(1.-circle)*4.;\n\t\n\t\n\t//float grid = border((uv_spiral - 0.5)*1., 0.2);\n\tfloat grid = geartile(uv_bipolar, -phase*1.);\n\n//\tgl_FragColor = vec4(uv,0.,1.0);\n\t\n\tgl_FragColor = mix( vec4(0,0,1,0), vec4(0), fract(uv_bipolar.y ));\n\tgl_FragColor = mix(gl_FragColor, vec4(0.16*abs(uv_spiral.x+uv_spiral.y),0.8,0.15,1.0), grid);\n//\tgl_FragColor = mix(gl_FragColor, vec4(0.5), circle);\n//\tgl_FragColor = mix(gl_FragColor, vec4(1), circle_outline);\n}", "user": "9ac67a5", "parent": "/e#10931.4", "id": "11746.0"}