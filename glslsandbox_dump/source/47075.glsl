{"code": "#ifdef GL_ES\nprecision mediump float;\n#endif\n\n#extension GL_OES_standard_derivatives : enable\n\nuniform float time;\nuniform vec2 mouse;\nuniform vec2 resolution;\n\n#define res resolution\n\n// mini raymarcher\n// based on https://www.shadertoy.com/view/4dtfRs\n// 2018-05-20\n\n//--- primitives: http://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm\n\nfloat sdSphere(vec3 p, float radius) \n{\n  return length(p) - radius;\n}\n\nfloat udRoundBox( vec3 p, vec3 dim, float radius )\n{\n  return length(max(abs(p)-dim,0.0))-radius;\n}\n\nfloat sdTorus( vec3 p, vec2 t )\n{\n  vec2 q = vec2(length(p.xz)-t.x,p.y);\n  return length(q)-t.y;\n}\n\n//--- basic rotations\n\nmat3 rotateX(float a) \n{\n  return mat3(\n    1.0, 0.0, 0.0,\n    0.0, cos(a), sin(a),\n    0.0, -sin(a), cos(a));\n}\n\nmat3 rotateY(float a) \n{\n  return mat3(\n    cos(a), 0.0, sin(a),\n    0.0, 1.0, 0.0,\n    -sin(a), 0.0, cos(a));\n}\n\nmat3 rotateZ(float a) \n{\n  return mat3(\n    cos(a), sin(a), 0.0,\n    -sin(a), cos(a), 0.0,\n    0.0, 0.0, 1.0);\n}\n\n//--- raymarcher\nfloat trace(vec3 o, vec3 r, mat3 tf, inout vec3 color) \n{\n    const vec3 color1 = vec3(1.2, 0.6, 0.0); \n    const vec3 color2 = vec3(0.2, 1.2, 0.8); \n    const vec3 color3 = vec3(0.5, 0.0, 1.4); \n    float t = 0.0,d,d2;\n    vec3 boxDim = vec3(0.2, 0.75, 2.0);\n    for (int i = 0; i < 32; i++) \n    {\n    \tvec3 p = o + r * t;\n        d = udRoundBox(tf*p, boxDim, 0.12 );\n        d2 = 0.9*sdSphere(p, 1.2);\n        if (d < d2) color = color1; else color = color2;\n        d = min(d,d2);\n        d2 = 0.9*sdTorus (tf * p, vec2(1.8,0.2));\n        if (d2 < d) color = color3;\n        d = min(d,d2);\n        t += d;\n    }\n    return t;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) \n{    \n    float atime = 0.3*time;\n    \n    vec2 ratio = vec2(res.x / res.y, 1.0);\n    vec2 uv = ratio * (2.0*(fragCoord / res.xy) -1.0);\n    vec2 mp = ratio * (2.0*(mouse) -1.0);\n\n    vec3 p = vec3(uv, 0.0) + vec3(0.0, 0.0, 1.4);\n    \n    vec3 l = vec3(uv, 0.0) + vec3(mp, 3.0);\n    vec3 n = normalize(p);\n    \n    vec3 lp = normalize(l - p);\n    vec3 lc = vec3(dot(lp, n));\n    vec3 color = vec3(1.0, 0.0, 0.0);\n    \n    vec3 r = normalize(p);\n    vec3 o = vec3(0.0, 0.0, -4.0);\n    \n    float t = trace(o, r, rotateZ(atime) * rotateY(atime), color);\n   \n    float fog = 1.0 / (1.0 + t*t *0.1);\n    \n    color.b *= fog;\n    vec3 fc = vec3(fog * lc * color);\n    \n    fragColor = vec4(fc, 1.0);\n}\n\nvoid main( void ) \n{\n    mainImage (gl_FragColor, gl_FragCoord.xy);\n}", "user": "c710e5", "parent": "/e#47056.4", "id": 47075}