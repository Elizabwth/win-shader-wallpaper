{"code": "precision mediump float;\nuniform vec4 frag[11];\nuniform sampler2D tex;\nvarying vec2 ftcoord;\nvarying vec2 fpos;\n\n\n#define scissorMat mat3(frag[0].xyz, frag[1].xyz, frag[2].xyz)\n#define paintMat mat3(frag[3].xyz, frag[4].xyz, frag[5].xyz)\n#define innerCol frag[6]\n#define outerCol frag[7]\n#define scissorExt frag[8].xy\n#define scissorScale frag[8].zw\n#define extent frag[9].xy\n#define radius frag[9].z\n#define feather frag[9].w\n#define strokeMult frag[10].x\n#define strokeThr frag[10].y\n#define texType int(frag[10].z)\n#define type int(frag[10].w)\n\n\nfloat sdroundrect(vec2 pt, vec2 ext, float rad) {\n    vec2 ext2 = ext - vec2(rad,rad);\n    vec2 d = abs(pt) - ext2;\n    return min(max(d.x,d.y),0.0) + length(max(d,0.0)) - rad;\n}\n\n// Scissoring\nfloat scissorMask(vec2 p) {\n    vec2 sc = (abs((scissorMat * vec3(p,1.0)).xy) - scissorExt);\n    sc = vec2(0.5,0.5) - sc * scissorScale;\n    return clamp(sc.x,0.0,1.0) * clamp(sc.y,0.0,1.0);\n}\n\n\nvoid main() {\n    vec4 result;\n    float scissor = scissorMask(fpos);\n\n    float strokeAlpha = 1.0;\n\n    if (type == 0) {                        // Gradient\n               // Calculate gradient color using box gradient\n               vec2 pt = (paintMat * vec3(fpos,1.0)).xy;\n               float d = clamp((sdroundrect(pt, extent, radius) + feather*0.5) / feather, 0.0, 1.0);\n               vec4 color = mix(innerCol,outerCol,d);\n               // Combine alpha\n               color *= strokeAlpha * scissor;\n               result = color;\n    } else if (type == 1) {         // Image\n               // Calculate color fron texture\n               vec2 pt = (paintMat * vec3(fpos,1.0)).xy / extent;\n               vec4 color = texture2D(tex, pt);\n               if (texType == 1) color = vec4(color.xyz*color.w,color.w);\n               if (texType == 2) color = vec4(color.x);\n               // Apply color tint and alpha.\n               color *= innerCol;\n               // Combine alpha\n               color *= strokeAlpha * scissor;\n               result = color;\n    }\n    else if (type == 2) {         // Stencil fill\n               result = vec4(1,1,1,1);\n    } else if (type == 3) {         // Textured tris\n               vec4 color = texture2D(tex, ftcoord);\n               if (texType == 1) color = vec4(color.xyz*color.w,color.w);\n               if (texType == 2) color = vec4(color.x);\n               color *= scissor;\n               result = color * innerCol;\n    }\n    gl_FragColor = result;\n}", "user": "f1fa5aa", "parent": null, "id": 47380}